import{a as b}from"./chunk-W345M3QW.js";import{t as i,u as a,z as p}from"./chunk-F6AVZLPP.js";import{ha as d,la as g,o as l,t as c,y as m}from"./chunk-PBCT4LDD.js";var h=class o{constructor(r,e){this.http=r;this.errorHandler=e;this.loadCurrentUser()}baseUrl=window?.__env?.apiBase??"https://backend.waselsy.com/api";currentUserSubject=new l(null);currentUser$=this.currentUserSubject.asObservable();getHeaders(){let r=localStorage.getItem("auth_token"),e=localStorage.getItem("dashboard_language")||"ar";return new i({"Content-Type":"application/json",Authorization:r?`Bearer ${r}`:"","Accept-Language":e})}handleError(r){let e=this.errorHandler.getLocalizedErrorMessage(r);return c(()=>new Error(e))}login(r,e){let t=new a().set("grant_type","password").set("username",r).set("password",e).set("client_id","DeliveryApp_App").set("client_secret","1q2w3e*");return this.http.post(`${this.baseUrl.replace(/\/api$/,"")}/connect/token`,t,{headers:new i({"Content-Type":"application/x-www-form-urlencoded"})}).pipe(m(n=>{let s=n.access_token,u=n.refresh_token;return localStorage.setItem("auth_token",s),u&&localStorage.setItem("refresh_token",u),this.currentUserSubject.next(null),{token:s,refreshToken:u,user:null,expiresIn:n.expires_in}}))}refreshToken(r){let e=new a().set("grant_type","refresh_token").set("refresh_token",r).set("client_id","DeliveryApp_App").set("client_secret","1q2w3e*");return this.http.post(`${this.baseUrl.replace(/\/api$/,"")}/connect/token`,e,{headers:new i({"Content-Type":"application/x-www-form-urlencoded"})}).pipe(m(t=>{let n=t.access_token,s=t.refresh_token;return localStorage.setItem("auth_token",n),s&&localStorage.setItem("refresh_token",s),{accessToken:n,refreshToken:s,expiresIn:t.expires_in}}))}logout(){localStorage.removeItem("auth_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("current_user"),this.currentUserSubject.next(null)}loadCurrentUser(){let r=localStorage.getItem("current_user");if(r)try{let e=JSON.parse(r);this.currentUserSubject.next(e)}catch(e){console.error("Error parsing stored user data:",e)}}isAuthenticated(){return!!localStorage.getItem("auth_token")}getCurrentUser(){return this.currentUserSubject.value}getDashboardOverview(){return this.http.get(`${this.baseUrl}/dashboard/overview`,{headers:this.getHeaders()})}getReviews(r=1,e=10,t){let n=new a().set("page",r.toString()).set("pageSize",e.toString());return t&&Object.keys(t).forEach(s=>{t[s]!==null&&t[s]!==void 0&&(n=n.set(s,t[s]))}),this.http.get(`${this.baseUrl}/dashboard/reviews`,{headers:this.getHeaders(),params:n})}getCurrentDeliveries(r=1,e=10){let t=new a().set("page",r.toString()).set("pageSize",e.toString());return this.http.get(`${this.baseUrl}/dashboard/current-deliveries`,{headers:this.getHeaders(),params:t})}getCustomers(r=1,e=10,t){let n=new a().set("page",r.toString()).set("pageSize",e.toString());return t&&Object.keys(t).forEach(s=>{t[s]!==null&&t[s]!==void 0&&(n=n.set(s,t[s]))}),this.http.get(`${this.baseUrl}/dashboard/customers`,{headers:this.getHeaders(),params:n})}getCancelledOrders(r=1,e=10){let t=new a().set("page",r.toString()).set("pageSize",e.toString());return this.http.get(`${this.baseUrl}/dashboard/cancelled-orders`,{headers:this.getHeaders(),params:t})}getCompletedOrders(r=1,e=10){let t=new a().set("page",r.toString()).set("pageSize",e.toString());return this.http.get(`${this.baseUrl}/dashboard/completed-orders`,{headers:this.getHeaders(),params:t})}getTimeDifferenceAnalysis(r=1,e=10){let t=new a().set("page",r.toString()).set("pageSize",e.toString());return this.http.get(`${this.baseUrl}/dashboard/time-difference-analysis`,{headers:this.getHeaders(),params:t})}getStores(r=1,e=10){let t=new a().set("page",r.toString()).set("pageSize",e.toString());return this.http.get(`${this.baseUrl}/dashboard/stores`,{headers:this.getHeaders(),params:t})}static \u0275fac=function(e){return new(e||o)(g(p),g(b))};static \u0275prov=d({token:o,factory:o.\u0275fac,providedIn:"root"})};export{h as a};
