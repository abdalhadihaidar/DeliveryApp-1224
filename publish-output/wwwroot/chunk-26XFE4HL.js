import{a as W}from"./chunk-IJRZG5DY.js";import{a as G}from"./chunk-SBN3BR4S.js";import{a as A,b as R}from"./chunk-H6HE4MHR.js";import{a as q,b as L}from"./chunk-RKVGNEAU.js";import{a as H,b as N}from"./chunk-YYCZXRKQ.js";import{$a as j,Ya as V,ab as $,h as T,n as D,x as S,z as B}from"./chunk-F6AVZLPP.js";import{Ac as E,L as x,Sb as p,Tb as r,Ub as l,Vb as b,Zb as I,cc as C,db as z,dc as d,fb as o,ha as y,kb as v,la as U,pc as w,rb as F,rc as s,sa as u,sc as c,t as P,ta as f,tc as h,xb as _,y as k,zb as M}from"./chunk-PBCT4LDD.js";var O=class a{constructor(t){this.http=t}baseUrl=`${W.apis.default.url}/api`;uploadImage(t,e="image"){let n=new FormData;return n.append("file",t),this.http.post(`${this.baseUrl}/app/file-upload/${e}`,n).pipe(x(i=>(console.error("Upload error:",i),P(()=>i))))}uploadImageWithProgress(t,e="image"){let n=new FormData;return n.append("file",t),this.http.post(`${this.baseUrl}/app/file-upload/${e}`,n,{reportProgress:!0,observe:"events"}).pipe(k(i=>{switch(i.type){case S.UploadProgress:if(i.total)return{loaded:i.loaded,total:i.total,percentage:Math.round(100*i.loaded/i.total)};break;case S.Response:return i.body;default:break}return null}),x(i=>(console.error("Upload error:",i),P(()=>i))))}deleteImage(t){return this.http.delete(`${this.baseUrl}/app/file-upload/image/${t}`).pipe(x(e=>(console.error("Delete error:",e),P(()=>e))))}getImageUrl(t){return`${this.baseUrl}/app/file-upload/image/${t}`}validateFile(t){return t.size>5242880?{valid:!1,error:"File size exceeds 5MB limit"}:["image/jpeg","image/png","image/gif","image/webp"].includes(t.type)?{valid:!0}:{valid:!1,error:"Invalid file type. Only JPG, PNG, GIF, and WebP files are allowed."}}createPreviewUrl(t){return new Promise((e,n)=>{let i=new FileReader;i.onload=g=>{e(g.target?.result)},i.onerror=g=>{n(g)},i.readAsDataURL(t)})}formatFileSize(t){if(t===0)return"0 Bytes";let e=1024,n=["Bytes","KB","MB","GB"],i=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,i)).toFixed(2))+" "+n[i]}static \u0275fac=function(e){return new(e||a)(U(B))};static \u0275prov=y({token:a,factory:a.\u0275fac,providedIn:"root"})};function Q(a,t){if(a&1&&(r(0,"span",11),s(1),l()),a&2){let e=d();o(),c(e.translationService.translate("optional")||"\u0627\u062E\u062A\u064A\u0627\u0631\u064A")}}function X(a,t){if(a&1){let e=I();r(0,"div",12)(1,"div",13),b(2,"img",14),r(3,"div",15)(4,"button",16),C("click",function(){u(e);let i=d();return f(i.removeImage())}),r(5,"mat-icon"),s(6,"close"),l()()()()()}if(a&2){let e=d();o(2),p("src",e.imageUrl,z)("alt",e.altText||"Image"),o(2),p("matTooltip",E(e.translationService.translate("removeImage")||"\u0625\u0632\u0627\u0644\u0629 \u0627\u0644\u0635\u0648\u0631\u0629"))}}function Z(a,t){if(a&1&&(r(0,"div",17)(1,"mat-icon",18),s(2),l(),r(3,"h5",19),s(4),l(),r(5,"p",20),s(6),l(),r(7,"div",21)(8,"span"),s(9),l(),r(10,"span",22),s(11),l()()()),a&2){let e=d();o(2),c(e.imageUrl?"edit":"cloud_upload"),o(2),h(" ",e.imageUrl?e.translationService.translate("changeImage")||"\u062A\u063A\u064A\u064A\u0631 \u0627\u0644\u0635\u0648\u0631\u0629":e.translationService.translate("selectImage")||"\u0627\u062E\u062A\u064A\u0627\u0631 \u0635\u0648\u0631\u0629"," "),o(2),h(" ",e.translationService.translate("dragDropOrClick")||"\u0627\u0633\u062D\u0628 \u0627\u0644\u0635\u0648\u0631\u0629 \u0647\u0646\u0627 \u0623\u0648 \u0627\u0646\u0642\u0631 \u0644\u0644\u0627\u062E\u062A\u064A\u0627\u0631"," "),o(3),c(e.translationService.translate("supportedFormats")||"\u0627\u0644\u0645\u0644\u0641\u0627\u062A \u0627\u0644\u0645\u062F\u0639\u0648\u0645\u0629: JPG, PNG, GIF"),o(2),c(e.translationService.translate("maxSize")||"\u0627\u0644\u062D\u062F \u0627\u0644\u0623\u0642\u0635\u0649: 5MB")}}function ee(a,t){if(a&1&&(r(0,"div",23),b(1,"mat-spinner",24),r(2,"p"),s(3),l(),r(4,"span",25),s(5),l()()),a&2){let e=d();o(3),c(e.translationService.translate("uploading")||"\u062C\u0627\u0631\u064D \u0627\u0644\u0631\u0641\u0639..."),o(2),h("",e.uploadProgress,"%")}}function te(a,t){if(a&1&&(r(0,"div",26)(1,"mat-icon"),s(2,"error"),l(),r(3,"span"),s(4),l()()),a&2){let e=d();o(4),c(e.errorMessage)}}function ne(a,t){if(a&1&&(r(0,"div",27)(1,"div",28)(2,"mat-icon"),s(3,"image"),l(),r(4,"div",29)(5,"span",30),s(6),l(),r(7,"span",31),s(8),l()()()()),a&2){let e=d();o(6),c(e.selectedFile.name),o(2),c(e.formatFileSize(e.selectedFile.size))}}var J=class a{constructor(t,e,n){this.translationService=t;this.snackBar=e;this.fileUploadService=n}title;imageUrl;altText;required=!1;maxSize=5*1024*1024;acceptedTypes=["image/jpeg","image/png","image/gif","image/webp"];imageSelected=new M;imageUploaded=new M;imageRemoved=new M;selectedFile=null;isDragOver=!1;isUploading=!1;uploadProgress=0;errorMessage="";ngOnInit(){}triggerFileInput(){let t=document.querySelector(".file-input");t&&t.click()}onFileSelected(t){let e=t.target.files[0];e&&this.handleFile(e)}onDragOver(t){t.preventDefault(),t.stopPropagation(),this.isDragOver=!0}onDragLeave(t){t.preventDefault(),t.stopPropagation(),this.isDragOver=!1}onDrop(t){t.preventDefault(),t.stopPropagation(),this.isDragOver=!1;let e=t.dataTransfer?.files;if(e&&e.length>0){let n=e[0];this.handleFile(n)}}handleFile(t){this.errorMessage="";let e=this.fileUploadService.validateFile(t);if(!e.valid){this.errorMessage=e.error||this.translationService.translate("invalidFile")||"\u0645\u0644\u0641 \u063A\u064A\u0631 \u0635\u0627\u0644\u062D";return}this.selectedFile=t,this.imageSelected.emit(t),this.uploadImage(t)}uploadImage(t){this.isUploading=!0,this.uploadProgress=0,this.fileUploadService.uploadImageWithProgress(t,"image").subscribe({next:e=>{if(typeof e=="object"&&"percentage"in e)this.uploadProgress=e.percentage;else if(typeof e=="object"&&"success"in e){let n=e;this.imageUploaded.emit(n),this.isUploading=!1,this.uploadProgress=0,this.snackBar.open(n.message||this.translationService.translate("imageUploadedSuccess")||"\u062A\u0645 \u0631\u0641\u0639 \u0627\u0644\u0635\u0648\u0631\u0629 \u0628\u0646\u062C\u0627\u062D",this.translationService.translate("close")||"\u0625\u063A\u0644\u0627\u0642",{duration:3e3})}},error:e=>{console.error("Upload error:",e),this.isUploading=!1,this.uploadProgress=0,this.errorMessage=e.error?.message||this.translationService.translate("uploadError")||"\u062E\u0637\u0623 \u0641\u064A \u0631\u0641\u0639 \u0627\u0644\u0635\u0648\u0631\u0629",this.snackBar.open(this.errorMessage,this.translationService.translate("close")||"\u0625\u063A\u0644\u0627\u0642",{duration:5e3})}})}removeImage(){this.imageUrl="",this.selectedFile=null,this.errorMessage="",this.imageRemoved.emit()}formatFileSize(t){return this.fileUploadService.formatFileSize(t)}reset(){this.imageUrl="",this.selectedFile=null,this.errorMessage="",this.isUploading=!1,this.uploadProgress=0}static \u0275fac=function(e){return new(e||a)(v($),v(G),v(O))};static \u0275cmp=F({type:a,selectors:[["app-image-picker"]],inputs:{title:"title",imageUrl:"imageUrl",altText:"altText",required:"required",maxSize:"maxSize",acceptedTypes:"acceptedTypes"},outputs:{imageSelected:"imageSelected",imageUploaded:"imageUploaded",imageRemoved:"imageRemoved"},decls:13,vars:16,consts:[["fileInput",""],[1,"image-picker-container"],[1,"image-picker-header"],["class","optional-text",4,"ngIf"],["class","current-image-container",4,"ngIf"],[1,"upload-area",3,"click","dragover","dragleave","drop"],["type","file","accept","image/*",1,"file-input",3,"change","multiple"],["class","upload-content",4,"ngIf"],["class","upload-progress",4,"ngIf"],["class","error-message",4,"ngIf"],["class","image-info",4,"ngIf"],[1,"optional-text"],[1,"current-image-container"],[1,"image-preview"],[1,"preview-image",3,"src","alt"],[1,"image-overlay"],["mat-icon-button","",1,"remove-btn",3,"click","matTooltip"],[1,"upload-content"],[1,"upload-icon"],[1,"upload-title"],[1,"upload-subtitle"],[1,"upload-formats"],[1,"max-size"],[1,"upload-progress"],["diameter","40"],[1,"progress-text"],[1,"error-message"],[1,"image-info"],[1,"file-details"],[1,"file-info"],[1,"file-name"],[1,"file-size"]],template:function(e,n){if(e&1){let i=I();r(0,"div",1)(1,"div",2)(2,"h4"),s(3),l(),_(4,Q,2,1,"span",3),l(),_(5,X,7,4,"div",4),r(6,"div",5),C("click",function(){return u(i),f(n.triggerFileInput())})("dragover",function(m){return u(i),f(n.onDragOver(m))})("dragleave",function(m){return u(i),f(n.onDragLeave(m))})("drop",function(m){return u(i),f(n.onDrop(m))}),r(7,"input",6,0),C("change",function(m){return u(i),f(n.onFileSelected(m))}),l(),_(9,Z,12,5,"div",7)(10,ee,6,2,"div",8),l(),_(11,te,5,1,"div",9)(12,ne,9,2,"div",10),l()}e&2&&(w("rtl",n.translationService.isRTL()),o(3),c(n.title||n.translationService.translate("imagePicker")||"\u0627\u062E\u062A\u064A\u0627\u0631 \u0627\u0644\u0635\u0648\u0631\u0629"),o(),p("ngIf",!n.required),o(),p("ngIf",n.imageUrl),o(),w("has-image",n.imageUrl)("drag-over",n.isDragOver)("uploading",n.isUploading),o(),p("multiple",!1),o(2),p("ngIf",!n.isUploading),o(),p("ngIf",n.isUploading),o(),p("ngIf",n.errorMessage),o(),p("ngIf",n.selectedFile))},dependencies:[D,T,N,H,j,V,L,q,R,A],styles:[".image-picker-container[_ngcontent-%COMP%]{width:100%;font-family:Cairo,Segoe UI,Tahoma,Geneva,Verdana,sans-serif}.image-picker-container.rtl[_ngcontent-%COMP%]{direction:rtl;text-align:right}.image-picker-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.image-picker-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;font-size:16px;font-weight:600;color:#1a1a1a}.image-picker-header[_ngcontent-%COMP%]   .optional-text[_ngcontent-%COMP%]{font-size:12px;color:#666;background:#667eea1a;padding:4px 8px;border-radius:12px;font-weight:500}.current-image-container[_ngcontent-%COMP%]{margin-bottom:16px}.current-image-container[_ngcontent-%COMP%]   .image-preview[_ngcontent-%COMP%]{position:relative;width:100%;max-width:200px;height:150px;border-radius:12px;overflow:hidden;box-shadow:0 4px 16px #0000001a;transition:transform .3s ease}.current-image-container[_ngcontent-%COMP%]   .image-preview[_ngcontent-%COMP%]:hover{transform:scale(1.02)}.current-image-container[_ngcontent-%COMP%]   .image-preview[_ngcontent-%COMP%]   .preview-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.current-image-container[_ngcontent-%COMP%]   .image-preview[_ngcontent-%COMP%]   .image-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .3s ease}.current-image-container[_ngcontent-%COMP%]   .image-preview[_ngcontent-%COMP%]   .image-overlay[_ngcontent-%COMP%]:hover{opacity:1}.current-image-container[_ngcontent-%COMP%]   .image-preview[_ngcontent-%COMP%]   .image-overlay[_ngcontent-%COMP%]   .remove-btn[_ngcontent-%COMP%]{background:#f44336e6;color:#fff;width:40px;height:40px}.current-image-container[_ngcontent-%COMP%]   .image-preview[_ngcontent-%COMP%]   .image-overlay[_ngcontent-%COMP%]   .remove-btn[_ngcontent-%COMP%]:hover{background:#f44336;transform:scale(1.1)}.current-image-container[_ngcontent-%COMP%]   .image-preview[_ngcontent-%COMP%]   .image-overlay[_ngcontent-%COMP%]   .remove-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.upload-area[_ngcontent-%COMP%]{border:2px dashed #d0d7de;border-radius:16px;padding:32px;text-align:center;cursor:pointer;transition:all .3s ease;background:#f8f9fa80;position:relative;overflow:hidden}.upload-area[_ngcontent-%COMP%]:hover{border-color:#667eea;background:#667eea0d;transform:translateY(-2px);box-shadow:0 8px 24px #667eea26}.upload-area.has-image[_ngcontent-%COMP%]{padding:20px;border-style:solid;border-color:#4caf50;background:#4caf500d}.upload-area.has-image[_ngcontent-%COMP%]:hover{border-color:#45a049;background:#4caf501a}.upload-area.drag-over[_ngcontent-%COMP%]{border-color:#667eea;background:#667eea1a;transform:scale(1.02);box-shadow:0 8px 32px #667eea33}.upload-area.uploading[_ngcontent-%COMP%]{border-color:#ff9800;background:#ff98001a;cursor:not-allowed}.upload-area.uploading[_ngcontent-%COMP%]:hover{transform:none;box-shadow:none}.upload-area[_ngcontent-%COMP%]   .file-input[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;cursor:pointer}.upload-area[_ngcontent-%COMP%]   .upload-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:12px}.upload-area[_ngcontent-%COMP%]   .upload-content[_ngcontent-%COMP%]   .upload-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;color:#667eea;transition:transform .3s ease}.upload-area[_ngcontent-%COMP%]   .upload-content[_ngcontent-%COMP%]:hover   .upload-icon[_ngcontent-%COMP%]{transform:scale(1.1)}.upload-area[_ngcontent-%COMP%]   .upload-content[_ngcontent-%COMP%]   .upload-title[_ngcontent-%COMP%]{margin:0;font-size:18px;font-weight:600;color:#1a1a1a}.upload-area[_ngcontent-%COMP%]   .upload-content[_ngcontent-%COMP%]   .upload-subtitle[_ngcontent-%COMP%]{margin:0;font-size:14px;color:#666;max-width:300px;line-height:1.5}.upload-area[_ngcontent-%COMP%]   .upload-content[_ngcontent-%COMP%]   .upload-formats[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px;font-size:12px;color:#999}.upload-area[_ngcontent-%COMP%]   .upload-content[_ngcontent-%COMP%]   .upload-formats[_ngcontent-%COMP%]   .max-size[_ngcontent-%COMP%]{font-weight:500;color:#667eea}.upload-area[_ngcontent-%COMP%]   .upload-progress[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:12px}.upload-area[_ngcontent-%COMP%]   .upload-progress[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:16px;font-weight:500;color:#1a1a1a}.upload-area[_ngcontent-%COMP%]   .upload-progress[_ngcontent-%COMP%]   .progress-text[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:#ff9800}.error-message[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-top:12px;padding:12px 16px;background:#f443361a;border:1px solid rgba(244,67,54,.2);border-radius:8px;color:#d32f2f;font-size:14px}.error-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.image-info[_ngcontent-%COMP%]{margin-top:16px;padding:16px;background:#667eea0d;border-radius:12px;border:1px solid rgba(102,126,234,.1)}.image-info[_ngcontent-%COMP%]   .file-details[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.image-info[_ngcontent-%COMP%]   .file-details[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#667eea;font-size:24px;width:24px;height:24px}.image-info[_ngcontent-%COMP%]   .file-details[_ngcontent-%COMP%]   .file-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.image-info[_ngcontent-%COMP%]   .file-details[_ngcontent-%COMP%]   .file-info[_ngcontent-%COMP%]   .file-name[_ngcontent-%COMP%]{font-size:14px;font-weight:500;color:#1a1a1a}.image-info[_ngcontent-%COMP%]   .file-details[_ngcontent-%COMP%]   .file-info[_ngcontent-%COMP%]   .file-size[_ngcontent-%COMP%]{font-size:12px;color:#666}@media (max-width: 768px){.upload-area[_ngcontent-%COMP%]{padding:24px 16px}.upload-area[_ngcontent-%COMP%]   .upload-content[_ngcontent-%COMP%]   .upload-icon[_ngcontent-%COMP%]{font-size:40px;width:40px;height:40px}.upload-area[_ngcontent-%COMP%]   .upload-content[_ngcontent-%COMP%]   .upload-title[_ngcontent-%COMP%]{font-size:16px}.upload-area[_ngcontent-%COMP%]   .upload-content[_ngcontent-%COMP%]   .upload-subtitle[_ngcontent-%COMP%]{font-size:13px}.current-image-container[_ngcontent-%COMP%]   .image-preview[_ngcontent-%COMP%]{max-width:100%;height:120px}.image-info[_ngcontent-%COMP%]{padding:12px}.image-info[_ngcontent-%COMP%]   .file-details[_ngcontent-%COMP%]   .file-info[_ngcontent-%COMP%]   .file-name[_ngcontent-%COMP%]{font-size:13px}.image-info[_ngcontent-%COMP%]   .file-details[_ngcontent-%COMP%]   .file-info[_ngcontent-%COMP%]   .file-size[_ngcontent-%COMP%]{font-size:11px}}@media (max-width: 480px){.upload-area[_ngcontent-%COMP%]{padding:20px 12px}.upload-area[_ngcontent-%COMP%]   .upload-content[_ngcontent-%COMP%]   .upload-icon[_ngcontent-%COMP%]{font-size:36px;width:36px;height:36px}.upload-area[_ngcontent-%COMP%]   .upload-content[_ngcontent-%COMP%]   .upload-title[_ngcontent-%COMP%]{font-size:15px}.upload-area[_ngcontent-%COMP%]   .upload-content[_ngcontent-%COMP%]   .upload-subtitle[_ngcontent-%COMP%]{font-size:12px}.upload-area[_ngcontent-%COMP%]   .upload-content[_ngcontent-%COMP%]   .upload-formats[_ngcontent-%COMP%]{font-size:11px}.image-picker-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:8px}.image-picker-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:15px}}"]})};export{J as a};
